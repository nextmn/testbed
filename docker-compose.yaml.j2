services:
  ue1:
    container_name: ue1
    hostname: ue1
    restart: always
    environment:
      MSISDN: "0000000001"
      GNBS: |-
        - "fd00:0:0:0:1:8000:0:2" # gnb1/ran
      CONFIGURED_NSSAI: |-
        - sst: 1
          sd: 000001
      DEFAULT_NSSAI: |-
        - sst: 1
          sd: 000001
      SESSIONS: |-
        - type: "IPv4"
          apn: "srv6"
          slice:
            sst: 1
            sd: 000001
    image: louisroyer/ueransim-ue
    cap_add:
      - NET_ADMIN
    devices:
      - "/dev/net/tun:/dev/net/tun"
    sysctls:
      net.ipv6.conf.all.disable_ipv6: 0
    command: [" "]
    networks:
      ran: # automatic allocation by docker compose

  ue2:
    container_name: ue2
    hostname: ue2
    restart: always
    environment:
      MSISDN: "0000000002"
      GNBS: |-
        - "fd00:0:0:0:1:8000:0:3" # gnb2/ran
      CONFIGURED_NSSAI: |-
        - sst: 1
          sd: 000001
      DEFAULT_NSSAI: |-
        - sst: 1
          sd: 000001
      SESSIONS: |-
        - type: "IPv4"
          apn: "srv6"
          slice:
            sst: 1
            sd: 000001
    image: louisroyer/ueransim-ue
    cap_add:
      - NET_ADMIN
    devices:
      - "/dev/net/tun:/dev/net/tun"
    sysctls:
      net.ipv6.conf.all.disable_ipv6: 0
    command: [" "]
    networks:
      ran: # automatic allocation by docker compose

  gnb1:
    container_name: gnb1
    hostname: gnb1
    restart: always
    environment:
      NCI: 000000001
      RLS_IP: "fd00:0:0:0:1:8000:0:2" # gnb1/ran
      N2_IP: "10.1.3.1" # gnb1/control
      N3_IP: "10.1.4.1" # gnb1/dataplane
      SUPPORTED_NSSAIS: |-
        - sst: 1
          sd: 000001
      MCC: "001"
      MNC: "01"
      ID_LEN: 32
      TAC: 1
      AMF_CONFIGS: |-
        - address: "10.1.3.4" # amf/control
          port: 38412
      ROUTES_INIT: |-
        - add 10.3.0.1 via 10.1.4.2 # srgw0/srgw0 via srgw0/dataplane
    image: louisroyer/ueransim-gnb
    command: [" "]
    cap_add:
      - NET_ADMIN
    devices:
      - "/dev/net/tun:/dev/net/tun"
    sysctls:
      net.ipv6.conf.all.disable_ipv6: 0
    networks:
      ran:
        ipv4_address: "10.1.0.1"
        ipv6_address: "fd00:0:0:0:1:8000:0:2"
      control:
        ipv4_address: "10.1.3.1"
      dataplane:
        ipv4_address: "10.1.4.1"

  gnb2:
    container_name: gnb2
    hostname: gnb2
    restart: always
    environment:
      NCI: 000000001
      RLS_IP: "fd00:0:0:0:1:8000:0:3" # gnb2/ran
      N2_IP: "10.1.3.2" # gnb2/control
      N3_IP: "10.1.4.2" # gnb2/dataplane
      SUPPORTED_NSSAIS: |-
        - sst: 1
          sd: 000001
      MCC: "001"
      MNC: "01"
      ID_LEN: 32
      TAC: 1
      AMF_CONFIGS: |-
        - address: "10.1.3.4" # amf/control
          port: 38412
      ROUTES_INIT: |-
        - add 10.3.0.1 via 10.1.4.2 # srgw0/srgw0 via srgw0/dataplane
    image: louisroyer/ueransim-gnb
    command: [" "]
    cap_add:
      - NET_ADMIN
    devices:
      - "/dev/net/tun:/dev/net/tun"
    sysctls:
      net.ipv6.conf.all.disable_ipv6: 0
    networks:
      ran:
        ipv4_address: "10.1.0.2"
        ipv6_address: "fd00:0:0:0:1:8000:0:3"
      control:
        ipv4_address: "10.1.3.2"
      dataplane:
        ipv4_address: "10.1.4.2"

  amf:
    container_name: amf
    hostname: amf
    restart: always
    environment:
      N2: "10.1.3.4" # amf/control
      SBI_REGISTER_IP: "amf.sbi"
      SBI_BINDING_IP: "10.1.1.1" # amf/sbi
      SBI_BINDING_PORT: "8000"
      MCC: "001"
      MNC: "01"
      AMF_ID: "000001"
      AMF_NAME: "AMF"
      NRF: "nrf.sbi:8000"
      SUPPORT_DNN_LIST: |-
        - srv6
      SNSSAI_LIST: |-
        - sst: 1
          sd: 000001
      TAC: "000001"
      LOCALITY: "area1"
    image: louisroyer/dev-free5gc-amf
    command: [" "]
    cap_add:
      - NET_ADMIN
    networks:
      control:
        ipv4_address: "10.1.3.4"
      sbi:
        ipv4_address: "10.1.1.1"

  mongodb:
    container_name: mongodb
    hostname: mongodb
    image: mongo
    command: "mongod --port 27017 --bind_ip_all"
    restart: always
    networks:
      db:

  nrf:
    container_name: nrf
    hostname: nrf
    restart: always
    environment:
      MONGO_HOST: "mongodb.db"
      SBI_REGISTER_IP: "nrf.sbi"
      SBI_BINDING_IP: "10.1.1.3" # nrf/sbi
      SBI_BINDING_PORT: "8000"
      MCC: "001"
      MNC: "01"
    image: "louisroyer/dev-free5gc-nrf"
    command: [" "]
    networks:
      db:
      sbi:
        ipv4_address: "10.1.1.3"

networks:
  ran:
    name: ran
    enable_ipv6: true
    driver: bridge
    driver_opts:
      com.docker.network.container_iface_prefix: ran-
      com.docker.network.bridge.name: ran
    ipam:
      driver: default
      config:
        - subnet: 10.1.0.0/24
          ip_range: 10.1.0.128/25
          gateway: 10.1.0.126
        - subnet: fd00:0:0:0:1::/80
          ip_range: fd00:0:0:0:1::/81
          gateway: fd00::1:8000:0:1
  sbi:
    name: sbi
    enable_ipv6: false
    driver: bridge
    driver_opts:
      com.docker.network.container_iface_prefix: sbi-
      com.docker.network.bridge.name: sbi
    ipam:
      driver: default
      config:
        - subnet: 10.1.1.0/24
          ip_range: 10.1.1.128/25
          gateway: 10.1.1.126
  db:
    name: db
    enable_ipv6: false
    driver: bridge
    driver_opts:
      com.docker.network.container_iface_prefix: db-
      com.docker.network.bridge.name: db
    ipam:
      driver: default
      config:
        - subnet: 10.1.2.0/24
          ip_range: 10.1.2.128/25
          gateway: 10.1.2.126
  control:
    name: control
    enable_ipv6: true
    driver: bridge
    driver_opts:
      com.docker.networks.container_iface_prefix: control-
      com.docker.network.bridge.name: control
    ipam:
      driver: default
      config:
        - subnet: 10.1.3.0/24
          ip_range: 10.1.3.128/25
          gateway: 10.1.3.126
        - subnet: fd00:0:0:0:2::/80
          ip_range: fd00:0:0:0:2::/81
          gateway: fd00::2:8000:0:1
  dataplane:
    name: dataplane
    enable_ipv6: true
    driver: bridge
    driver_opts:
      com.docker.networks.container_iface_prefix: dataplane-
      com.docker.network.bridge.name: dataplane
    ipam:
      driver: default
      config:
        - subnet: 10.1.4.0/24
          ip_range: 10.1.4.128/25
          gateway: 10.1.4.126
        - subnet: fd00:0:0:0:3::/80
          ip_range: fd00:0:0:0:3::/81
          gateway: fd00::3:8000:0:1
  edge:
    name: edge
    enable_ipv6: false
    driver: bridge
    driver_opts:
      com.docker.networks.container_iface_prefix: edge-
      com.docker.network.bridge.name: edge
    ipam:
      driver: default
      config:
        - subnet: 10.1.5.0/24
          ip_range: 10.1.5.128/25
          gateway: 10.1.5.126
